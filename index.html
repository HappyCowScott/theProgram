<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>#theProgram - Activity Feed</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5fa;
            color: #2d3134;
            line-height: 1.5;
        }

        /* Navigation */
        nav {
            background: white;
            border-bottom: 1px solid #e5e5ea;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            height: 56px;
            gap: 40px;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            color: #3674b5;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 30px;
            flex: 1;
        }

        .nav-link {
            color: #2d3134;
            text-decoration: none;
            font-size: 16px;
            padding: 16px 0;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            cursor: pointer;
        }

        .nav-link:hover {
            color: #3674b5;
        }

        .nav-link.active {
            border-bottom-color: #3674b5;
            color: #3674b5;
        }

        .nav-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        /* Main Container & Views */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px 20px;
        }

        .view-content {
            display: none;
        }

        .view-content.active {
            display: block;
        }
        
        /* Dashboard Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 24px;
        }

        .profile-card {
            background: white;
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            height: fit-content;
            position: sticky;
            top: 80px; /* Adjust based on nav height */
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 16px;
            background: #3674b5;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            font-weight: bold;
            overflow: hidden;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-name {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e5e5ea;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
            display: block;
            color: #3674b5;
        }

        .stat-label {
            font-size: 14px;
            color: #606065;
        }

        .stat-item {
            text-align: center;
        }

        /* Activity Feed */
        .activity-feed {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .activity-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 20px;
            display: flex;
            gap: 16px;
        }

        .activity-card-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e5e5ea;
            flex-shrink: 0;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
        }

        .activity-card-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .activity-card-main {
            flex: 1;
        }
        
        .activity-card-header {
            display: flex;
            flex-direction: column;
            margin-bottom: 8px;
        }

        .activity-card-user {
            font-weight: 600;
            color: #2d3134;
        }

        .activity-card-meta {
            font-size: 13px;
            color: #606065;
        }

        .activity-card-title {
            font-size: 22px;
            font-weight: 600;
            margin: 8px 0;
            color: #3674b5;
            cursor: pointer;
            text-decoration: none;
        }
        .activity-card-title:hover {
            text-decoration: underline;
        }

        .activity-card-image {
            width: 100%;
            border-radius: 8px;
            margin-top: 16px;
            max-height: 400px;
            object-fit: cover;
            cursor: pointer;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            margin: 20px;
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid #e5e5ea;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #606065;
        }

        /* Other styles for forms, buttons etc. can be kept from previous versions */
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px; }
        .form-input, .form-select, .form-textarea { width: 100%; padding: 12px; border: 1px solid #e5e5ea; border-radius: 6px; font-size: 16px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .participants-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; max-height: 200px; overflow-y: auto; padding: 12px; border: 1px solid #e5e5ea; border-radius: 6px; }
        .picture-upload-container { text-align: center; }
        .picture-preview { width: 120px; height: 120px; border-radius: 50%; margin: 0 auto 16px; background: #e5e5ea; display: flex; align-items: center; justify-content: center; overflow: hidden; cursor: pointer; }
        #workoutPreview { border-radius: 8px; width: 100%; height: 200px; }
        .picture-preview img { width: 100%; height: 100%; object-fit: cover; }
        .picture-preview-placeholder { font-size: 48px; color: #606065; }
        .picture-upload-input { display: none; }
        .modal-body { padding: 24px; }
        .modal-footer { padding: 24px; border-top: 1px solid #e5e5ea; display: flex; gap: 12px; justify-content: flex-end; }
        .btn { padding: 10px 20px; border-radius: 6px; font-size: 16px; font-weight: 500; cursor: pointer; border: none; }
        .btn-primary { background: #3674b5; color: white; }
        .btn-secondary { background: #e5e5ea; color: #2d3134; }
        
    </style>
</head>
<body>
    <div id="appContainer" style="display: block;">
        <nav>
            <div class="nav-container">
                <a href="#" class="logo">#theProgram</a>
                <div class="nav-links">
                    <a class="nav-link active" onclick="showView('dashboard')">Dashboard</a>
                    <a class="nav-link" onclick="showView('workouts')">Workouts</a>
                    <a class="nav-link" onclick="showView('members')">Members</a>
                </div>
                <div class="nav-actions">
                    <div class="user-menu">
                        <button class="user-button" onclick="toggleUserMenu()">
                            <div class="user-avatar-small" id="navUserAvatar"></div>
                            <span id="navUserName"></span>
                            <span style="font-size: 12px;">â–¼</span>
                        </button>
                        <div id="userDropdown" class="user-dropdown" style="display: none;">
                            <div class="user-dropdown-item" onclick="logout()">ðŸšª Logout</div>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="showAddWorkout()">Add Workout</button>
                </div>
            </div>
        </nav>

        <main class="main-container">
            <div id="dashboardView" class="view-content active">
                <div class="dashboard-grid">
                    <aside>
                        <div class="profile-card">
                            <div class="profile-avatar" id="userAvatar"></div>
                            <h2 class="profile-name" id="userName"></h2>
                            <div class="profile-stats">
                                <div class="stat-item">
                                    <span id="userWorkouts" class="stat-value">-</span>
                                    <span class="stat-label">Workouts</span>
                                </div>
                                <div class="stat-item">
                                    <span id="userTrainer" class="stat-value">-</span>
                                    <span class="stat-label">As Trainer</span>
                                </div>
                                <div class="stat-item">
                                    <span id="userTotal" class="stat-value">-</span>
                                    <span class="stat-label">Total</span>
                                </div>
                            </div>
                        </div>
                    </aside>
                    <section id="activityFeed" class="activity-feed">
                        </section>
                </div>
            </div>
            <div id="workoutsView" class="view-content">Workouts view content</div>
            <div id="membersView" class="view-content">Members view content</div>
        </main>
    </div>

    <div id="addWorkoutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add New Workout</h2>
                <button class="modal-close" onclick="closeModal('addWorkoutModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="workoutForm">
                     <div class="form-group">
                        <label class="form-label">Workout Title</label>
                        <input type="text" id="workoutTitle" class="form-input" placeholder="e.g., Morning Strength Session">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Date *</label>
                            <input type="date" id="workoutDate" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Time *</label>
                            <input type="time" id="workoutTime" class="form-input" value="06:00" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Trainer *</label>
                            <select id="workoutTrainer" class="form-select" required></select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Type *</label>
                             <select id="workoutType" class="form-select">
                                <option value="General">General</option>
                                <option value="Run">Run</option>
                                <option value="Ride">Ride</option>
                                <option value="Swim">Swim</option>
                                <option value="Strength">Strength</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Location</label>
                        <input type="text" id="workoutLocation" class="form-input" value="LCHS">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Participants</label>
                        <div id="participantsList" class="participants-grid"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Description / Details</label>
                        <textarea id="workoutDescription" class="form-textarea" placeholder="Brief description of the workout"></textarea>
                    </div>
                    
                    <div class="picture-upload-container">
                        <div id="workoutPreview" class="picture-preview" onclick="document.getElementById('workoutPictureUpload').click()">
                            <div id="workoutPreviewPlaceholder" class="picture-preview-placeholder">ðŸ“·</div>
                            <img id="workoutPreviewImg" style="display: none;" alt="Workout preview">
                        </div>
                        <label class="form-label">Click to add a photo</label>
                        <input type="file" id="workoutPictureUpload" class="picture-upload-input" accept="image/*" onchange="previewPicture(event, 'workoutPreviewImg', 'workoutPreviewPlaceholder', (dataUrl) => { selectedWorkoutPicture = dataUrl; })">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addWorkoutModal')">Cancel</button>
                <button class="btn btn-primary" id="saveWorkoutBtn" onclick="saveWorkout()">Save Workout</button>
            </div>
        </div>
    </div>
    
    <script>
        // --- Hardcoded dummy data for demonstration without a real backend ---
        // In your real app, these would be populated by the 'initializeApp' function
        let scriptUrl = 'https://your-script-url.example.com';
        let members = [
            {id: 999, firstName: 'Scott', lastName: 'Metcalf', status: 'Active', profilePictureURL: 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs='},
            {id: 1, firstName: 'Charlie', lastName: 'Handsome', status: 'Active', profilePictureURL: ''},
        ];
        let workouts = [
            {id: 1, date: '2025-07-01', time: '07:30', trainerId: 999, trainer: 'Scott Metcalf', type: 'Strength', location: 'LCHS', notes: 'Strength Workout', participantIds: ['1'], participantCount: 1, workoutPictureURL: ''},
            {id: 2, date: '2025-06-30', time: '06:00', trainerId: 1, trainer: 'Charlie Handsome', type: 'Run', location: 'The Track', notes: 'Morning Run', participantIds: ['999'], participantCount: 1, workoutPictureURL: ''},
        ];
        let currentUserId = 999;
        let currentUserData = members.find(m => m.id == currentUserId);
        let selectedWorkoutPicture = null;
        // --- End of dummy data ---

        // Initialize App on Load
        document.addEventListener('DOMContentLoaded', () => {
            // This is where you would normally call your backend
            // For this demo, we'll just populate the views with the dummy data
            updateUIForUser();
            populateDashboard();
        });

        function updateUIForUser() {
            if (!currentUserData) return;
            const name = `${currentUserData.firstName} ${currentUserData.lastName}`;
            const initials = getInitials(name);
            const picUrl = currentUserData.profilePictureURL;

            function setAvatar(element, url, text) {
                element.innerHTML = ''; 
                if (url && url.startsWith('data:image')) {
                    const img = document.createElement('img');
                    img.src = url;
                    img.alt = text;
                    element.appendChild(img);
                } else {
                    element.textContent = text;
                }
            }

            setAvatar(document.getElementById('navUserAvatar'), picUrl, initials);
            setAvatar(document.getElementById('userAvatar'), picUrl, initials);
            document.getElementById('navUserName').textContent = name;
            document.getElementById('userName').textContent = name;
            
            // Dummy stats
            document.getElementById('userWorkouts').textContent = 1;
            document.getElementById('userTrainer').textContent = 1;
            document.getElementById('userTotal').textContent = 2;
        }

        function populateDashboard() {
            const feed = document.getElementById('activityFeed');
            const recentWorkouts = workouts.sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 15);
            
            feed.innerHTML = recentWorkouts.map(workout => {
                const trainerData = members.find(m => m.id == workout.trainerId);
                let trainerAvatarHtml = getInitials(workout.trainer);
                if (trainerData && trainerData.profilePictureURL && trainerData.profilePictureURL.startsWith('data')) {
                    trainerAvatarHtml = `<img src="${trainerData.profilePictureURL}" alt="${trainerAvatarHtml}">`;
                }
                
                return `
                <div class="activity-card">
                    <div class="activity-card-avatar">${trainerAvatarHtml}</div>
                    <div class="activity-card-main">
                        <div class="activity-card-header">
                            <strong class="activity-card-user">${workout.trainer}</strong>
                            <span class="activity-card-meta">
                                ${formatDate(workout.date)} at ${formatTime(workout.time)}
                            </span>
                        </div>
                        <a href="#" class="activity-card-title" onclick="event.preventDefault(); alert('Showing details for workout ${workout.id}')">
                            ${workout.notes || workout.type + ' Workout'}
                        </a>
                        
                        ${workout.workoutPictureURL ? `
                            <img src="${workout.workoutPictureURL}" class="activity-card-image" alt="Workout Image" onclick="alert('Showing details for workout ${workout.id}')">
                        ` : ''}
                    </div>
                </div>
                `;
            }).join('') || '<p>No recent workouts found.</p>';
        }

        function saveWorkout() {
            alert('Saving workout... (demo)');
            closeModal('addWorkoutModal');
        }

        // --- Utility Functions ---
        function showView(viewName) { 
            document.querySelectorAll('.view-content').forEach(v => v.classList.remove('active'));
            document.getElementById(`${viewName}View`).classList.add('active');
            if(viewName === 'dashboard') populateDashboard();
        }

        function populateTrainerDropdown() {
             const select = document.getElementById('workoutTrainer');
             select.innerHTML = members.map(m => `<option value="${m.id}">${m.firstName} ${m.lastName}</option>`).join('');
        }

        function showAddWorkout() { 
            document.getElementById('workoutForm').reset();
            populateTrainerDropdown();
            openModal('addWorkoutModal');
        }

        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }

        function toggleUserMenu() { 
            const menu = document.getElementById('userDropdown');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }
        
        function logout() { alert('Logging out... (demo)'); }

        function getInitials(name) {
            if (!name) return '?';
            return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            // This handles the timezone offset to prevent showing the previous day
            const userTimezoneOffset = date.getTimezoneOffset() * 60000;
            return new Date(date.getTime() + userTimezoneOffset).toLocaleDateString('en-US', { 
                month: 'long', 
                day: 'numeric', 
                year: 'numeric' 
            });
        }

        function formatTime(timeStr) {
            if (!timeStr) return '';
            const [hours, minutes] = timeStr.split(':');
            if(isNaN(hours) || isNaN(minutes)) return timeStr; // Failsafe
            
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12; // Converts 0 or 12 to 12
            return `${displayHour}:${minutes} ${ampm}`;
        }
        
        function previewPicture(event, imgId, placeholderId, callback) { 
            const file = event.target.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = e => {
                document.getElementById(imgId).src = e.target.result;
                document.getElementById(imgId).style.display = 'block';
                document.getElementById(placeholderId).style.display = 'none';
                if(callback) callback(e.target.result);
            };
            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>
